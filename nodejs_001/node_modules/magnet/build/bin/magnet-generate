#!/usr/bin/env node
'use strict';

var _path = require('path');

var _fs = require('fs');

var _log = require('../log');

var _log2 = _interopRequireDefault(_log);

var _minimist = require('minimist');

var _minimist2 = _interopRequireDefault(_minimist);

var _package = require('../../package.json');

var _package2 = _interopRequireDefault(_package);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const argv = (0, _minimist2.default)(process.argv.slice(2), {
  alias: {
    h: 'help'
  },
  boolean: ['h']
});

if (argv.help) {
  console.log(`
    Description
      Scaffolds a simple project structure to get started quickly.
    Usage
      $ magnet generate
    Options
      --help, -h      Displays this message
  `);
  process.exit(0);
}

const dir = (0, _path.resolve)(argv._[0] || '.');

const basePackage = `{
  "name": "my-app",
  "engines": {
    "node": ">=8.9.0"
  },
  "dependencies": {
    "magnet": "^${_package2.default.version}"
  },
  "scripts": {
    "dev": "magnet",
    "start": "magnet build && magnet start"
  }
}`;

const baseApi = `export const route = {
  method: 'get',
  path: '/api',
  type: 'json',
};

export default async (req) => {
  return {hello: 'Magnet'};
};
`;

const baseMagnetConfig = `module.exports = {
  magnet: {
    port: 3000,
  },
};
`;

const baseIndex = `export const route = {
  method: 'get',
  path: '/',
  type: 'html',
};

export default () => \`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Magnet</title>
</head>
<body>
  <h1>It works!</h1>
  <a href="/api">http://localhost:3000/api</a>
</body>
</html>\`;
`;

_log2.default.info(false, 'Generating files');

if (!(0, _fs.existsSync)(dir)) {
  (0, _fs.mkdirSync)(dir);
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'package.json'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'package.json'), basePackage.replace(/my-app/g, (0, _path.basename)(dir)));
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'static'))) {
  (0, _fs.mkdirSync)((0, _path.join)(dir, 'static'));
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'index.js'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'index.js'), baseIndex);
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'api.js'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'api.js'), baseApi);
}
if (!(0, _fs.existsSync)((0, _path.join)(dir, 'magnet.config.js'))) {
  (0, _fs.writeFileSync)((0, _path.join)(dir, 'magnet.config.js'), baseMagnetConfig);
}

_log2.default.info(false, 'Done.');