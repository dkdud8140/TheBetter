'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.errorMiddleware = errorMiddleware;

var _prettyError = require('pretty-error');

var _prettyError2 = _interopRequireDefault(_prettyError);

var _log = require('../log');

var _log2 = _interopRequireDefault(_log);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Error middleware.
 * @return {Function}
 */
function errorMiddleware() {
  return (err, req, res, next) => {
    const status = err.status || err.code || 500;
    const message = err.message || '';
    let result = {
      status,
      message
    };
    if (err.errors) {
      result.errors = err.errors;
    }
    const renderedError = new _prettyError2.default().render(err);
    const serializedError = JSON.stringify(result, 2, 2);
    _log2.default.error(false, `${renderedError}${serializedError}`);
    res.status(status).json(result);
  };
}